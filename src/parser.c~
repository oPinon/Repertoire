#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include "parser.h"

list_t read() {
  
FILE* f = fopen("repertory.txt","r");

 size_t buffer_size = 4*1023*sizeof(char)+4;
 char buffer[buffer_size];
 fread(  buffer ,sizeof(char), buffer_size, f);  

 //char* towrite= "foobar\n";

 printf("%s\n",buffer);

 size_t i=0;
 while(true){
	char* string= malloc(1023*sizeof(char));
	while(fgetc(buffer)!=','){
 		*string=fgetc(buffer);
		 string++;
	}
        printf("%s\n",string);
	free(string);
	string=NULL;
	
	if(buffer[i]=='\0') break;
	else i++;
 }






 fclose(f);

  return NULL;
}

size_t length(char* chaine){
	size_t i=0;
	while(true){
		if(chaine[i]=='\0') break;
		else i++;
	}
	return i;
	
}

void write() {
  
FILE* f = fopen("repertory.txt","w");


 
 //char buffer[buffer_size];

 char* buffer1= "PA,DURAND,0643539442,Toulouse,\n\0";
 char* buffer2= "PA2,DURAND2,0102030404,Lyon,\n\0";

 //printf("%s\n",buffer1);

 //fgets(buffer,256,stdin);
	
 fwrite(buffer1, sizeof(char), length(buffer1), f);
 fwrite(buffer2, sizeof(char), length(buffer2), f);

 fclose(f);

}

int main(int argc, const char* argv[])
{
	write();
	read();

	return 0;
}
